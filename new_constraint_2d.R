theta <- c(1.23418645,  1.52583452,  1.25706844,  1.38109885,  1.43554437,
           0.88675089,  0.81482692,  1.01043299,  0.61860507,  0.6424324 ,
           0.33660988,  0.27319474,  0.17496905,  1.57079633,  1.08318008,
           1.2714623 ,  1.43795271,  1.26688685,  1.38109885,  1.43030663,
           1.57079633,  1.21825438,  1.28002518,  0.08146894,  1.29159382,
           0.90560027,  1.11787411,  1.30506721,  0.70363895,  1.00193587,
           0.71262239,  0.96016821,  0.53538306,  0.77519337,  0.70051615,
           0.55759883,  0.38400234,  0.59745958,  0.39810396,  0.29712252,
           0.96016821,  1.26568564,  0.46529574,  1.32703403,  1.57079633,
           1.16954918,  1.32205628,  1.4534863 ,  1.01058064,  1.01781597,
           1.34235933,  0.84695707,  0.86676237,  0.69143955,  0.88931936,
           1.07231589,  0.70439919,  0.54488653,  0.85464286,  0.61062811,
           0.30449629,  1.47012257,  1.5059986 ,  1.57079633,  1.05599037,
           1.34809704,  0.92849181,  0.9853926 ,  1.09636552,  0.85749964,
           0.97333675,  0.62955368,  0.48761624,  1.50757181,  1.35676834,
           1.47046098,  1.1210755 ,  1.03420691,  0.94685624,  0.69931617,
           1.57079633,  1.47741017,  0.15290741,  1.39166572,  1.1455244 ,
           0.86715738,  0.51546654,  0.42667772,  1.57079633,  1.16357543,
           1.32277474,  1.51584517,  1.57079633,  1.38455756,  1.45109439,
           1.57079633,  1.16909899,  0.1732103 ,  0.11537217,  1.04623262,
           1.40892577,  0.91965887,  1.01034988,  0.81875624,  0.96175972,
           0.5982291 ,  0.7429744 ,  0.64710689,  0.88689213,  0.36790038,
           1.57079633,  1.40676239,  1.57079633,  0.6337324 ,  0.15191361,
           1.29884905,  1.11494658,  0.88102133,  1.145717  ,  0.77746132,
           0.80298973,  0.97387432,  0.82166183,  0.57502012,  1.57079633,
           0.95531662,  0.        ,  1.42518709,  1.57079633,  1.0259098 ,
           1.23809371,  0.07840635,  1.07317765,  1.5253496 ,  1.53001113,
           0.52659025,  1.10244824,  0.96805255,  1.3833    ,  0.72344198,
           1.10990167,  0.20495115,  0.03709645,  1.45467867,  0.80323713,
           1.15231721,  1.0544088 ,  0.78034757,  0.52389849,  0.7967998 ,
           1.53060834,  0.95654052,  0.90330108,  0.5733295 ,  0.689775  ,
           0.43054377,  0.17610783,  0.98597256,  1.16404448,  0.92972199,
           1.18480956,  0.76025937,  0.74758435,  0.65793511,  0.74399749,
           0.84824574,  1.21073446,  0.61963311,  1.20175425,  0.29898155,
           1.52071277,  0.75890602,  0.41236418,  0.51640856,  0.35211174,
           0.13298738,  1.08893704,  0.88254085,  1.25533758,  1.57079633,
           1.30963892,  0.6847192 ,  0.33983691,  1.43558301,  0.43410463,
           1.24431365,  0.89999452,  0.57618336,  0.50282167,  0.8527358 ,
           1.37291823,  1.17601805,  0.43119854,  0.07188416,  1.12059118,
           1.3890966 ,  0.21638433,  1.02192612,  0.6431717 ,  1.2252965 ,
           1.37885809,  1.52078329,  1.39582728,  1.57079633,  1.19700415,
           1.02132908,  0.75204009,  0.51480596,  0.38759669,  0.31982992,
           0.33983691,  1.07057876,  1.16642079,  1.25850688,  1.09931477,
           1.20895582,  1.4547764 ,  1.29515353,  1.44447246,  0.99520486,
           1.18319964,  0.61547971,  0.26572912,  0.1404897 ,  1.03372297,
           1.4306382 ,  0.66496368,  0.91153815,  1.23095942,  1.47305075,
           1.57079633,  1.57079633,  1.10076882,  1.2433419 ,  1.37144912,
           1.27367381,  0.82389773,  0.88607712,  0.44051066,  0.49848044,
           0.20135792,  0.10835955,  1.31827729,  1.18679398,  1.29688305,
           0.97405318,  0.43406252,  0.16187056,  1.49168776,  1.34334646,
           1.33931896,  1.50123544,  1.57079633,  1.05882364,  1.07991365,
           1.28255388,  1.36943841,  0.75596941,  1.11526297,  0.82782193,
           0.54946724,  0.34928257,  0.2756428 ,  0.13525196,  1.13028566,
           1.37713803,  1.44877765,  1.37210609,  1.15633859,  1.39758602,
           0.87042273,  0.89496869,  0.93706393,  0.54459495,  0.45553336,
           0.23147736,  1.18797001,  1.26336252,  1.40256017,  1.57079633,
           1.39758602,  1.57079633,  1.57079633,  1.03554019,  1.46934847,
           0.96386221,  0.98748461,  1.23418645,  0.72712681,  0.61547971,
           0.53213166,  0.24963295,  0.10170989)
phi <- c(1.43347569e-01,   3.95995822e-01,   4.08637855e-01,
         4.89650043e-01,   5.23598776e-01,   9.09092982e-02,
         0.00000000e+00,   4.79216381e-01,   1.14960921e-01,
         3.33473172e-01,   5.23598776e-01,   4.08637855e-01,
         6.14390615e-08,   4.41306432e-01,   2.10734243e-08,
         1.90125603e-01,   3.33473172e-01,   6.40622493e-02,
         1.77296301e-01,   1.49011612e-08,   1.56176871e-01,
         2.60418171e-01,   3.10383266e-01,   5.23598776e-01,
         4.22063799e-01,   2.42563874e-01,   4.08637855e-01,
         5.23598776e-01,   2.10734243e-08,   4.41306432e-01,
         1.90125603e-01,   5.23598776e-01,   1.14960921e-01,
         5.23598776e-01,   4.71160505e-01,   3.33473172e-01,
         5.77119491e-08,   5.23598776e-01,   2.81034902e-01,
         5.23598776e-01,   1.43347569e-01,   3.95995822e-01,
         4.59536526e-01,   2.56644657e-01,   3.80251207e-01,
         0.00000000e+00,   1.56176871e-01,   0.00000000e+00,
         6.40622493e-02,   1.90125603e-01,   4.41306432e-01,
         2.58095683e-08,   2.81034902e-01,   8.22923432e-02,
         4.08637855e-01,   5.23598776e-01,   2.42563874e-01,
         3.65002415e-08,   4.85127748e-01,   5.23598776e-01,
         7.45058060e-08,   3.80251207e-01,   4.08637855e-01,
         4.59536526e-01,              0,   2.81034902e-01,
         3.10383266e-01,   3.55394354e-01,   4.32689477e-01,
         4.51554895e-01,   5.23598776e-01,   2.42563874e-01,
         4.94215606e-08,   2.74826914e-01,   4.43823948e-02,
         8.22923432e-02,   3.52095222e-01,   3.72817649e-01,
         3.95995822e-01,   2.81034902e-01,   2.13215510e-01,
         1.14960921e-01,   4.08637855e-01,   4.59536526e-01,
         2.81034902e-01,   0.00000000e+00,   2.42563874e-01,
         3.67421905e-01,   4.71160505e-01,   1.32454598e-01,
         2.74826914e-01,   3.08007343e-01,   2.96637697e-01,
         3.84710274e-02,   3.68354757e-02,   1.01534977e-01,
         2.18512252e-01,   5.23598776e-01,   2.42563874e-01,
         1.90125603e-01,   5.23598776e-01,   1.56176871e-01,
         2.42563874e-01,   3.33473172e-01,   4.41306432e-01,
         6.91714992e-02,   5.23598776e-01,   4.51554895e-01,
         2.01018574e-01,   9.09092982e-02,   2.66954118e-01,
         1.01534977e-01,   9.09092982e-02,   5.23598776e-01,
         5.23598776e-01,   3.85130184e-01,   2.42563874e-01,
         2.58095683e-08,   4.59536526e-01,   1.56176871e-01,
         3.52095222e-01,   4.75523326e-01,   4.41306432e-01,
         1.90125603e-01,   5.23598776e-01,   1.49011612e-08,
         0,   3.67421905e-01,   4.79216381e-01,
         2.10734243e-08,   2.13215510e-01,   3.34530239e-07,
         4.59536526e-01,   1.96202900e-01,   4.94739277e-01,
         4.22063799e-01,   4.63943752e-01,   4.35008149e-01,
         2.34507998e-01,   2.81034902e-01,   1.01534977e-01,
         3.33473172e-01,   5.23598776e-01,   5.23598776e-01,
         4.22200376e-02,   4.71160505e-01,   4.08637855e-01,
         3.80251207e-01,   5.58145753e-02,   4.54427276e-01,
         9.86530367e-02,   7.20438807e-02,   5.03692775e-01,
         2.01018574e-01,   3.80251207e-01,   5.23598776e-01,
         1.14960921e-01,   1.01534977e-01,   2.66954118e-01,
         1.05649089e-01,   4.27669082e-01,   4.02584876e-02,
         2.42563874e-01,   1.32454598e-01,   4.59536526e-01,
         7.20438807e-02,   4.79216381e-01,   1.32454598e-01,
         2.93676935e-01,   4.08637855e-01,   1.23092435e-01,
         4.08637855e-01,   1.56176871e-01,   3.98740745e-01,
         5.23598776e-01,   3.80251207e-01,   2.42563874e-01,
         3.14814285e-02,   4.85127748e-01,   0.00000000e+00,
         3.33473172e-01,   5.23598776e-01,   3.65002415e-08,
         1.67399191e-01,   3.86990602e-01,   6.91714992e-02,
         4.76820741e-01,   4.59536526e-01,   3.80251207e-01,
         2.09584392e-01,   1.23092435e-01,   4.86763300e-01,
         4.43823948e-02,   1.90125603e-01,   4.55487584e-02,
         2.26961079e-01,   1.43347569e-01,   1.64584686e-01,
         9.09092982e-02,   3.95995822e-01,   4.96112829e-01,
         1.53266830e-02,   1.49011612e-08,   1.90125603e-01,
         2.42563874e-01,   5.23598776e-01,   3.33473172e-01,
         3.33200094e-08,   5.23598776e-01,   1.32454598e-01,
         3.80251207e-01,   5.58145753e-02,   5.24382707e-02,
         4.94468275e-02,   3.72817649e-01,   1.39524076e-01,
         4.82382825e-01,   0.00000000e+00,   1.56176871e-01,
         4.08637855e-01,   5.23598776e-01,   2.10734243e-08,
         5.23598776e-01,   1.85517961e-07,   2.29921841e-01,
         6.91714992e-02,   5.58145753e-02,   3.98740745e-01,
         0.00000000e+00,   2.42563874e-01,   3.33473172e-01,
         1.14960921e-01,   1.56176871e-01,   2.81034902e-01,
         3.80251207e-01,   5.23598776e-01,   1.90125603e-01,
         5.23598776e-01,   3.65002415e-08,   5.23598776e-01,
         5.23598776e-01,   1.78813934e-07,   3.21528562e-01,
         0,   1.14960921e-01,   2.81034902e-01,
         2.42563874e-01,   5.23598776e-01,   1.95422345e-01,
         1.90125603e-01,   1.49011612e-08,   1.71503554e-01,
         2.42563874e-01,   1.14960921e-01,   3.33473172e-01,
         4.71160505e-01,   5.23598776e-01,   2.98023224e-08,
         5.23598776e-01,   5.23598776e-01,   5.23598776e-01,
         2.42563874e-01,   9.65705618e-08,   5.23598776e-01,
         2.10734243e-08,   2.42563874e-01,   3.05086524e-01,
         8.22923432e-02,   3.67421905e-01,   5.23598776e-01,
         1.14960921e-01,   3.33473172e-01,   5.23598776e-01,
         1.56176871e-01,   5.23598776e-01,   8.02452088e-08,
         8.22923432e-02,   1.56176871e-01,   2.81034902e-01,
         4.22063799e-01,   1.43347569e-01,   3.10383266e-01,
         6.40622493e-02,   9.09092982e-02,   4.51554895e-01,
         1.90125603e-01,   3.67421905e-01,   5.23598776e-01,
         1.14960921e-01,   3.80251207e-01,   2.81034902e-01,
         2.42563874e-01,   5.23598776e-01)


xs <- c(9.34198733e-01,   9.21680503e-01,   8.72871561e-01,
        8.66666667e-01,   8.58116330e-01,   7.71822241e-01,
        7.27606875e-01,   7.51646028e-01,   5.76071529e-01,
        5.66138517e-01,   2.86038777e-01,   2.47593784e-01,
        1.74077656e-01,   9.04194430e-01,   8.83452209e-01,
        9.38314863e-01,   9.36585812e-01,   9.52216581e-01,
        9.66666667e-01,   9.90147543e-01,   9.87829161e-01,
        9.06854138e-01,   9.12245461e-01,   7.04761479e-02,
        8.76919233e-01,   7.63762616e-01,   8.25136997e-01,
        8.35629022e-01,   6.46996639e-01,   7.61797697e-01,
        6.42038738e-01,   7.09524247e-01,   5.06803034e-01,
        6.06091527e-01,   5.74376772e-01,   5.00000000e-01,
        3.74634325e-01,   4.87177352e-01,   3.72462513e-01,
        2.53546276e-01,   8.10884854e-01,   8.80000837e-01,
        4.02139493e-01,   9.38652205e-01,   9.28571429e-01,
        9.20574618e-01,   9.57427108e-01,   9.93127066e-01,
        8.45402793e-01,   8.35629022e-01,   8.80704846e-01,
        7.49268649e-01,   7.32333837e-01,   6.35488909e-01,
        7.12696645e-01,   7.60638829e-01,   6.28618557e-01,
        5.18321055e-01,   6.67297681e-01,   4.96563533e-01,
        2.99812676e-01,   9.23869771e-01,   9.15737093e-01,
        8.96258160e-01,   8.70388280e-01,   9.37042571e-01,
        7.62456368e-01,   7.81403801e-01,   8.07572853e-01,
        6.80413817e-01,   7.16001556e-01,   5.71547607e-01,
        4.68521286e-01,   9.60549161e-01,   9.76221040e-01,
        9.91603546e-01,   8.45320607e-01,   8.00416558e-01,
        7.48776780e-01,   6.18441686e-01,   9.77355555e-01,
        9.89070710e-01,   1.39771312e-01,   8.81917104e-01,
        8.75189949e-01,   7.62492852e-01,   4.78510149e-01,
        3.86226968e-01,   8.91042111e-01,   9.10182055e-01,
        9.33020529e-01,   9.51501156e-01,   9.56324716e-01,
        9.81980506e-01,   9.92170778e-01,   9.94849751e-01,
        8.98512571e-01,   1.49255579e-01,   1.11746400e-01,
        8.49945896e-01,   8.54704323e-01,   7.85714286e-01,
        8.22221725e-01,   6.90065559e-01,   7.41619849e-01,
        5.61833219e-01,   5.85850099e-01,   5.42453796e-01,
        7.59503988e-01,   3.58171936e-01,   9.64578857e-01,
        9.81495458e-01,   9.95870595e-01,   5.12822594e-01,
        1.31055608e-01,   8.92691182e-01,   8.71601929e-01,
        7.71389216e-01,   8.16496581e-01,   6.92934867e-01,
        6.75300045e-01,   7.35308986e-01,   6.62122192e-01,
        5.34051746e-01,   8.66025404e-01,   8.16496581e-01,
        5.55111512e-17,   9.23380517e-01,   8.87356509e-01,
        8.55186110e-01,   9.23760431e-01,   7.83260450e-02,
        7.87561531e-01,   9.79801163e-01,   8.79360646e-01,
        4.58484037e-01,   7.97992765e-01,   7.47061530e-01,
        9.55582489e-01,   6.35998728e-01,   8.91042111e-01,
        1.92307692e-01,   3.21191043e-02,   8.60193517e-01,
        7.18966389e-01,   8.14152342e-01,   7.98007469e-01,
        6.53274580e-01,   4.99480519e-01,   6.42546846e-01,
        9.94334232e-01,   8.15082733e-01,   6.87835939e-01,
        5.31509590e-01,   5.90909091e-01,   3.61448698e-01,
        1.74042499e-01,   8.29515062e-01,   8.85879568e-01,
        7.96985060e-01,   8.42988684e-01,   6.88551061e-01,
        6.59966329e-01,   6.06128125e-01,   6.06976979e-01,
        7.48175624e-01,   8.30454799e-01,   5.75649676e-01,
        8.92741817e-01,   2.70294951e-01,   9.91189256e-01,
        6.31469630e-01,   3.95898663e-01,   4.55025045e-01,
        2.98675490e-01,   1.23124611e-01,   8.60193517e-01,
        7.71972594e-01,   8.40963288e-01,   1.00000000e+00,
        9.12870929e-01,   5.47722558e-01,   3.33333333e-01,
        9.77021630e-01,   3.89494591e-01,   9.44911183e-01,
        6.95950464e-01,   4.88306074e-01,   4.47478454e-01,
        7.36603808e-01,   9.73067266e-01,   8.15867296e-01,
        4.17548356e-01,   7.05280640e-02,   8.99424030e-01,
        9.58314847e-01,   2.12497579e-01,   8.41585931e-01,
        5.97259883e-01,   8.68092293e-01,   8.63289805e-01,
        9.98632304e-01,   9.84731928e-01,   9.81980506e-01,
        9.03696114e-01,   7.38548946e-01,   6.45497224e-01,
        4.92365964e-01,   3.27326835e-01,   3.11651146e-01,
        3.09523810e-01,   8.76111799e-01,   9.18084559e-01,
        9.50469532e-01,   8.29695978e-01,   9.26158422e-01,
        8.79936422e-01,   9.62250449e-01,   9.79957887e-01,
        7.69800359e-01,   8.01783726e-01,   5.77350269e-01,
        2.27429413e-01,   1.40028008e-01,   8.36598919e-01,
        9.87825975e-01,   6.16069691e-01,   7.28436789e-01,
        9.42809042e-01,   9.66091783e-01,   9.44911183e-01,
        9.93399268e-01,   8.80704846e-01,   9.09717652e-01,
        9.10182055e-01,   8.28078671e-01,   7.20576692e-01,
        6.70820393e-01,   4.26401433e-01,   4.14039336e-01,
        1.73205081e-01,   1.08147614e-01,   9.18664829e-01,
        9.27172650e-01,   9.56365070e-01,   7.94719414e-01,
        4.08248290e-01,   1.39572632e-01,   9.77897823e-01,
        9.56689206e-01,   9.73328527e-01,   9.82946374e-01,
        9.70725343e-01,   8.66025404e-01,   8.33333333e-01,
        8.54282143e-01,   8.48528137e-01,   6.85994341e-01,
        7.77713771e-01,   6.37792804e-01,   4.52267017e-01,
        3.32205299e-01,   2.72165527e-01,   1.16774842e-01,
        9.04534034e-01,   9.52579344e-01,   9.46729262e-01,
        9.77008421e-01,   8.54242196e-01,   8.53066687e-01,
        7.59554525e-01,   7.37209781e-01,   6.97863158e-01,
        5.11766316e-01,   3.81000381e-01,   2.29415734e-01,
        9.24473452e-01,   9.41513084e-01,   9.47204446e-01,
        9.12245461e-01,   9.74933356e-01,   9.52216581e-01,
        9.97948716e-01,   8.56586153e-01,   8.95143593e-01,
        8.06599287e-01,   7.78936180e-01,   8.17423891e-01,
        6.60338180e-01,   5.36110964e-01,   4.87466678e-01,
        2.39816048e-01,   8.79315573e-02)
ys <- c(1.34839972e-01,   3.85337318e-01,   3.77964473e-01,
        4.61880215e-01,   4.95433694e-01,   7.03597545e-02,
        4.16333634e-17,   3.90566733e-01,   6.65190105e-02,
        1.96116135e-01,   1.65144565e-01,   1.07211253e-01,
        0.00000000e+00,   4.27121098e-01,   4.16333634e-17,
        1.80578780e-01,   3.24442842e-01,   6.10847222e-02,
        1.73205081e-01,   2.77555756e-17,   1.55542754e-01,
        2.41648837e-01,   2.92602868e-01,   4.06894229e-02,
        3.93780765e-01,   1.88982237e-01,   3.57294801e-01,
        4.82450641e-01,   4.16333634e-17,   3.59856086e-01,
        1.23560413e-01,   4.09644015e-01,   5.85205736e-02,
        3.49927106e-01,   2.92602868e-01,   1.73205081e-01,
        5.55111512e-17,   2.81271975e-01,   1.07520666e-01,
        1.46385011e-01,   1.17041147e-01,   3.67911832e-01,
        1.99007438e-01,   2.46332320e-01,   3.71153744e-01,
        4.16333634e-17,   1.50755672e-01,   2.77555756e-17,
        5.42326145e-02,   1.60816880e-01,   4.16025147e-01,
        3.46944695e-17,   2.11406569e-01,   5.24142418e-02,
        3.08606700e-01,   4.39155033e-01,   1.55542754e-01,
        2.77555756e-17,   3.51763235e-01,   2.86691090e-01,
        5.55111512e-17,   3.69274473e-01,   3.96525793e-01,
        4.43532763e-01,   3.46944695e-17,   2.70500890e-01,
        2.44557994e-01,   2.90020947e-01,   3.73001923e-01,
        3.29983165e-01,   4.13383691e-01,   1.41421356e-01,
        2.77555756e-17,   2.70838131e-01,   4.33554985e-02,
        8.17860820e-02,   3.10574778e-01,   3.13049517e-01,
        3.13049517e-01,   1.78528737e-01,   2.11603685e-01,
        1.14208048e-01,   6.05227533e-02,   4.36435780e-01,
        2.52645576e-01,   3.46944695e-17,   1.18400556e-01,
        1.48658829e-01,   4.53920650e-01,   1.21267813e-01,
        2.63076110e-01,   3.02702757e-01,   2.92306411e-01,
        3.77964473e-02,   3.65636212e-02,   1.01360607e-01,
        1.99521721e-01,   8.61727484e-02,   2.76500632e-02,
        1.63572164e-01,   4.93463771e-01,   1.23717915e-01,
        2.03447115e-01,   2.39045722e-01,   3.50324525e-01,
        3.89249472e-02,   3.38240713e-01,   2.63076110e-01,
        1.54764647e-01,   3.26511574e-02,   2.63794672e-01,
        1.00000000e-01,   9.07841299e-02,   2.96078263e-01,
        7.56649908e-02,   3.61873432e-01,   2.15665546e-01,
        3.46944695e-17,   4.04061018e-01,   1.09108945e-01,
        2.48108422e-01,   3.78635615e-01,   3.12771621e-01,
        1.02778306e-01,   5.00000000e-01,   3.66114544e-17,
        0.00000000e+00,   3.55409327e-01,   4.61083968e-01,
        3.46944695e-17,   2.00000000e-01,   0.00000000e+00,
        3.89741881e-01,   1.94745209e-01,   4.74407361e-01,
        2.05882353e-01,   3.99291826e-01,   3.47156922e-01,
        2.28292058e-01,   1.83597018e-01,   9.07841299e-02,
        6.66173388e-02,   1.85439735e-02,   4.96632958e-01,
        3.03728370e-02,   4.14750948e-01,   3.45547370e-01,
        2.61116484e-01,   2.79072786e-02,   3.13901580e-01,
        9.84135663e-02,   5.88235294e-02,   3.79071253e-01,
        1.08306072e-01,   2.36188746e-01,   2.08682503e-01,
        2.00966968e-02,   8.45154255e-02,   2.42271856e-01,
        8.45154255e-02,   3.84236640e-01,   2.77350098e-02,
        1.63299316e-01,   8.07572853e-02,   3.00375705e-01,
        5.39949247e-02,   4.31516971e-01,   7.66964989e-02,
        2.69984382e-01,   1.17041147e-01,   1.22627868e-01,
        2.73434371e-01,   6.23378726e-02,   1.91706445e-01,
        1.72440375e-01,   4.92134036e-02,   2.12842696e-01,
        2.43108319e-02,   4.43310347e-01,   5.55111512e-17,
        3.16227766e-01,   3.16227766e-01,   5.55111512e-17,
        1.65097669e-01,   1.58735158e-01,   6.54653671e-02,
        3.59511694e-01,   2.41648837e-01,   1.78858943e-01,
        1.56681518e-01,   1.20385853e-01,   4.31787770e-01,
        1.85439735e-02,   1.35731322e-02,   4.09960031e-02,
        2.21313334e-01,   3.06713836e-02,   1.39776536e-01,
        5.44465506e-02,   3.62933093e-01,   4.67269314e-01,
        1.53069194e-02,   2.77555756e-17,   1.88982237e-01,
        2.23606798e-01,   4.26401433e-01,   2.23606798e-01,
        2.77555756e-17,   1.88982237e-01,   4.15227399e-02,
        1.23717915e-01,   4.89506500e-02,   4.81869425e-02,
        4.70360434e-02,   3.24500939e-01,   1.30066495e-01,
        4.60772783e-01,   2.77555756e-17,   1.54303350e-01,
        3.33333333e-01,   4.62910050e-01,   2.77555756e-17,
        1.31306433e-01,   0.00000000e+00,   1.95815112e-01,
        6.84385911e-02,   3.44214195e-02,   3.06897453e-01,
        2.77555756e-17,   2.39045722e-01,   3.27326835e-01,
        1.14707867e-01,   1.38675049e-01,   2.62612866e-01,
        3.63803438e-01,   4.78091444e-01,   1.38675049e-01,
        3.87298335e-01,   2.77555756e-17,   2.39045722e-01,
        1.00000000e-01,   0.00000000e+00,   3.05995031e-01,
        4.16333634e-17,   1.10431526e-01,   2.29415734e-01,
        1.01015254e-01,   8.05822964e-02,   1.93573567e-01,
        1.84114924e-01,   2.77555756e-17,   1.70251306e-01,
        2.40192231e-01,   1.00000000e-01,   2.88675135e-01,
        4.35194140e-01,   4.89897949e-01,   4.16333634e-17,
        4.49013255e-01,   3.68229847e-01,   2.61116484e-01,
        8.21994937e-02,   5.55111512e-17,   6.74199862e-02,
        4.16333634e-17,   2.35702260e-01,   2.98142397e-01,
        8.05822964e-02,   3.28797975e-01,   4.92518281e-01,
        8.77058019e-02,   2.55376959e-01,   4.02911482e-01,
        8.05822964e-02,   2.19970673e-01,   0.00000000e+00,
        7.62492852e-02,   1.48249863e-01,   2.73434371e-01,
        4.09644015e-01,   1.40719509e-01,   3.05423611e-01,
        6.40184400e-02,   7.80868809e-02,   4.34121571e-01,
        1.55230105e-01,   2.99812676e-01,   4.71939904e-01,
        7.62492852e-02,   2.14285714e-01,   1.40719509e-01,
        5.93390829e-02,   5.07673083e-02)
zs <- c(3.30289130e-01,   4.49466575e-02,   3.08606700e-01,
        1.88561808e-01,   1.34839972e-01,   6.31933489e-01,
        6.85994341e-01,   5.31494003e-01,   8.14688170e-01,
        8.00640769e-01,   9.43879807e-01,   9.62913841e-01,
        9.84731928e-01,  -5.55111512e-17,   4.68521286e-01,
        2.94883912e-01,   1.32453236e-01,   2.99252801e-01,
        1.88561808e-01,   1.40028008e-01,   5.55111512e-17,
        3.45284537e-01,   2.86691090e-01,   9.96683241e-01,
        2.75589127e-01,   6.17213400e-01,   4.37594974e-01,
        2.62612866e-01,   7.62492852e-01,   5.38672318e-01,
        7.56649908e-01,   5.73382179e-01,   8.60073269e-01,
        7.14285714e-01,   7.64509572e-01,   8.48528137e-01,
        9.27172650e-01,   8.26767382e-01,   9.21797691e-01,
        9.56182887e-01,   5.73382179e-01,   3.00398753e-01,
        8.93688910e-01,   2.41355396e-01,   0.00000000e+00,
        3.90566733e-01,   2.46182982e-01,   1.17041147e-01,
        5.31368931e-01,   5.25225731e-01,   2.26455407e-01,
        6.62266179e-01,   6.47297778e-01,   7.70328887e-01,
        6.29940788e-01,   4.78091444e-01,   7.62000762e-01,
        8.55186110e-01,   6.56487952e-01,   8.19288030e-01,
        9.53998092e-01,   1.00503782e-01,   6.47523908e-02,
        0.00000000e+00,   4.92365964e-01,   2.20863052e-01,
        5.99042298e-01,   5.52535927e-01,   4.56832193e-01,
        6.54330305e-01,   5.62543950e-01,   8.08290377e-01,
        8.83452209e-01,   6.31824024e-02,   2.12397698e-01,
        1.00167084e-01,   4.34714134e-01,   5.11207720e-01,
        5.84237395e-01,   7.65282543e-01,   0.00000000e+00,
        9.32504808e-02,   9.88332422e-01,   1.78174161e-01,
        4.12568499e-01,   6.46996639e-01,   8.70062840e-01,
        9.10345694e-01,   0.00000000e+00,   3.96059017e-01,
        2.45486565e-01,   5.49235036e-02,   5.55111512e-17,
        1.85164020e-01,   1.19416287e-01,   0.00000000e+00,
        3.90981127e-01,   9.85036563e-01,   9.93352010e-01,
        5.00835422e-01,   1.61164593e-01,   6.06091527e-01,
        5.31564395e-01,   6.83130051e-01,   5.72077554e-01,
        8.26334244e-01,   7.36459694e-01,   7.97831336e-01,
        6.31824024e-01,   9.33084544e-01,   5.55111512e-17,
        1.63299316e-01,   5.55111512e-17,   8.05822964e-01,
        9.88483301e-01,   2.68607655e-01,   4.40225453e-01,
        6.36363636e-01,   4.12393049e-01,   7.12696645e-01,
        6.94558896e-01,   5.62099427e-01,   6.81005225e-01,
        8.39181358e-01,   0.00000000e+00,   5.77350269e-01,
        1.00000000e+00,   1.45095250e-01,  -1.11022302e-16,
        5.18321055e-01,   3.26598632e-01,   9.96927796e-01,
        4.77334371e-01,   4.54310850e-02,   4.07738935e-02,
        8.64525792e-01,   4.51412876e-01,   5.66904879e-01,
        1.86399685e-01,   7.49531689e-01,   4.44749590e-01,
        9.79070928e-01,   9.99312005e-01,   1.15856889e-01,
        6.94380891e-01,   4.06371277e-01,   4.93741931e-01,
        7.10669055e-01,   8.65875508e-01,   6.98998819e-01,
        4.01771702e-02,   5.76350528e-01,   6.19020764e-01,
        8.40099608e-01,   7.71389216e-01,   9.08738935e-01,
        9.84533052e-01,   5.52052447e-01,   3.95628284e-01,
        5.98056818e-01,   3.76473483e-01,   7.24657302e-01,
        7.33333333e-01,   7.91256568e-01,   7.35767207e-01,
        6.61300071e-01,   3.52332132e-01,   8.14091578e-01,
        3.60722167e-01,   9.55636965e-01,   5.00626174e-02,
        7.25589244e-01,   9.16175877e-01,   8.69598095e-01,
        9.38646509e-01,   9.91170203e-01,   4.63427557e-01,
        6.35190756e-01,   3.10252614e-01,   0.00000000e+00,
        2.58198890e-01,   7.74596669e-01,   9.42809042e-01,
        1.34801682e-01,   9.07246997e-01,   3.20713490e-01,
        6.21614264e-01,   8.38548160e-01,   8.76226290e-01,
        6.57925324e-01,   1.96589275e-01,   3.84603532e-01,
        9.08465459e-01,   9.97417446e-01,   4.35150253e-01,
        1.80701581e-01,   9.76680114e-01,   5.21723721e-01,
        8.00197604e-01,   3.38667005e-01,   1.90761898e-01,
        4.99921893e-02,   1.74077656e-01,   0.00000000e+00,
        3.65148372e-01,   5.22232968e-01,   7.30296743e-01,
        8.70388280e-01,   9.25820100e-01,   9.49288905e-01,
        9.42809042e-01,   4.79616460e-01,   3.93444738e-01,
        3.07238149e-01,   4.54206698e-01,   3.53996163e-01,
        1.15759816e-01,   2.72165527e-01,   1.25988158e-01,
        5.44331054e-01,   3.77964473e-01,   8.16496581e-01,
        9.64901281e-01,   9.90147543e-01,   5.11623584e-01,
        1.39699689e-01,   7.86939198e-01,   6.12530651e-01,
        3.33333333e-01,   9.75900073e-02,  -5.55111512e-17,
        0.00000000e+00,   4.52910814e-01,   3.21633760e-01,
        1.98029509e-01,   2.92770022e-01,   6.79366220e-01,
        6.32455532e-01,   9.04534034e-01,   8.78310066e-01,
        9.79795897e-01,   9.94134847e-01,   2.49843896e-01,
        3.74634325e-01,   2.70500890e-01,   5.61951487e-01,
        9.07264709e-01,   9.86927542e-01,   7.90260780e-02,
        2.25493808e-01,   2.29415734e-01,   6.95048047e-02,
        -5.55111512e-17,   4.89897949e-01,   4.71404521e-01,
        2.84267622e-01,   2.00000000e-01,   7.27606875e-01,
        4.39941345e-01,   6.76481425e-01,   8.52802865e-01,
        9.39618477e-01,   9.62250449e-01,   9.90867389e-01,
        4.26401433e-01,   1.92450090e-01,   1.21716124e-01,
        1.97385508e-01,   4.02693633e-01,   1.72345497e-01,
        6.44503387e-01,   6.25543242e-01,   5.92156525e-01,
        8.55337203e-01,   8.98026510e-01,   9.73328527e-01,
        3.73543684e-01,   3.02613766e-01,   1.67443672e-01,
        0.00000000e+00,   1.72345497e-01,   0.00000000e+00,
        0.00000000e+00,   5.10061370e-01,   1.01273937e-01,
        5.70351825e-01,   5.50791055e-01,   3.30289130e-01,
        7.47087368e-01,   8.16496581e-01,   8.61727484e-01,
        9.69003166e-01,   9.94832007e-01)

library(scatterplot3d)
library(plotly)
library(MCMCpack)
library(splines)
library(tmg)

E1 <- function(theta,phi){
  e <- 75.1*cos(theta) + 354.4*sin(theta)*cos(phi) + 206.8*sin(theta)*sin(phi)
  return(e)
}


E2 <- function(theta,phi){
  e <- 75.1*sin(theta) + 354.4*cos(theta)*sin(phi) + 206.8*cos(theta)*cos(phi)
}


eng1 <- E1(theta,phi)
eng2 <- E2(theta,phi)
eng <- as.vector(t(cbind(eng1,eng2)))
re <- theta*eng1 + phi*eng2



n <- length(theta)
A <- matrix(0,100,2*n)
for (i in 1:100){
  ind <- sample(1:(2*n),30)
  A[i,ind] <- rnorm(30)
}
b <- A %*% eng
# ind <- sample(1:l,25)
# A[ind,n] <- A[ind,n] - b[ind] / y[n] 
A[,2*n] <- A[,2*n] - b / eng[2*n] 

s <- cbind(theta,phi)

bbasis <- cbind(1,bs(theta,5),bs(phi,5))

basis <- matrix(0,2*n,2*ncol(bbasis))
for (i in 1:n){
  basis[2*i-1,1:ncol(bbasis)] <- bbasis[i,]
  basis[2*i,1:ncol(bbasis)+ncol(bbasis)] <- bbasis[i,]
}

y <- rep(0,dim(A)[1])

Bayes_Kriging<-function(y,s,basis,A,
                        sp=NULL,Xp=NULL,
                        df=4,b_var=diag(dim(A)[1]),
                        sd_beta=1000,can_df = 4,
                        iters=1000,burn=100){
  
  
  # Bookkeeping
  
  p        <- ncol(basis)
  
  
  predictions<-!is.null(sp) 
  np <- 1
  if(predictions){
    np <- nrow(sp)*3
    predbbasis <- bs(sp[,1],df=10)
    for (j in c(2,3,5,6)){
      predbbasis1 <- bs(sp[,j],df=10)
      predbbasis <- cbind(predbbasis,predbbasis1)
    }
    predbbasis <- cbind(1,predbbasis)
    
    predbasis <- matrix(0,3*np,3*ncol(predbbasis))
    for (i in 1:n){
      predbasis[3*i-2,1:ncol(predbbasis)] <- predbbasis[i,]
      predbasis[3*i-1,1:ncol(predbbasis)+ncol(predbbasis)] <- predbbasis[i,]
      predbasis[3*i,1:ncol(predbbasis)+2*ncol(predbbasis)] <- predbbasis[i,]
    }
  }
  
  
  # Initial values
  bbb <- matrix(0,n,2*n)
  for (i in 1:n){
    bbb[i,(2*i-1):(2*i)] <- s[i,]
  }
  X <- A%*%basis
  beta    <- rep(1,dim(basis)[2])
  fff <- beta
  sigma2 <- cov(matrix(eng-basis%*%fff,n,2))
  Sigma <- A%*%kronecker(diag(n),sigma2)%*%t(A)
  
  Siginv  <- solve(Sigma + diag(dim(Sigma)[1]))
  
  
  # Keep track of stuff
  
  keep.beta <- matrix(0,iters,p)
  keeper.sigma2 <-   list()
  pred  <- pred_norm    <- matrix(0,iters,np)
  
  
  #colnames(keepers)   <- c("sigma2","range","gamma2","epsilon")
  colnames(keep.beta) <- colnames(X)
  
  # GO!!!
  
  for(i in 1:iters){
    if(i %% 100 ==0){print(i)}
    ##############################################:
    #####       beta(Gibbs)    #######:
    ##############################################:
    tXS  <- t(X)%*% Siginv
    VVV1  <- tXS%*%X + diag(p)/sd_beta^2
    VVV <- solve(VVV1)
    MMM  <- VVV%*%tXS%*%y
    Q <- list()
    Q[[1]] <- list(t(basis)%*%basis, rep(0,p), -n)
    beta <- as.vector(rtmg(1,VVV1,as.vector(VVV1%*%MMM),fff,f = basis,
                           g = rep(0,dim(basis)[1]),q=Q))
    fff <- beta
    
    
    #############################################:
    ####          sigma2 (Gibbs)        #######:
    #############################################:
    
    R      <- y- X%*%beta
    a      <- n + df
    b      <- R%*%t(R) + b_var
    Sigma <- riwish(a,b_var)
    Siginv  <- solve(Sigma + diag(dim(Sigma)[1]))
    
    
    
    ##############################################:
    #####        KEEP TRACK OF STUFF       #######:
    ##############################################:
    
    keep.beta[i,]  <- beta
    keeper.sigma2[[i]]  <- Sigma
    
    
    
    ##############################################:
    #####           PREDICTIONS            #######:
    ##############################################:
    
    if(i>burn & predictions){
      pred[i,] <- predbasis%*%beta
      pred_norm[i,] <- pred[i,] / sqrt(sum(pred[i,]^2))
    }
    
  }   
  
  
  list(beta=keep.beta,sigma2=keeper.sigma2,pred=pred, pred_norm=pred_norm)}


try <- Bayes_Kriging(y,s,basis,A,sp=s ,iters = 5000)
lb <- apply(try$beta[1000:5000,],2,quantile,probs = c(0.025,0.975))
eng_est <- as.vector(basis%*%colMeans(try$beta[1000:5000,]))
eng_est <- matrix(eng_est,ncol = 2,byrow = TRUE)
eng_est_lower <- as.vector(basis%*%lb[1,])
eng_est_lower <- matrix(eng_est_lower,ncol = 2,byrow = TRUE)
eng_est_upper <- as.vector(basis%*%lb[2,])
eng_est_upper <- matrix(eng_est_upper,ncol = 2,byrow = TRUE)

ratio1 <- max(eng_est[,1]) / max(eng1)
eng1_est <- eng_est[,1] / ratio1
eng1_est_lower <- eng_est_lower[,1] / ratio1
eng1_est_upper <- eng_est_upper[,1] / ratio1

ratio2 <- max(eng_est[,2]) / max(eng2)
eng2_est <- eng_est[,2] / ratio2
eng2_est_lower <- eng_est_lower[,2] / ratio2
eng2_est_upper <- eng_est_upper[,2] / ratio2

pp <- cbind(xs,ys,eng1)
pp <- setNames(data.frame(pp), c("theta", "phi", "energy"))
plot_ly(pp, x = ~theta, y = ~phi,type = "scatter", mode = "markers", 
        color = ~energy, marker = list(size = 10))%>%
  layout(title = "C1 true values")

pp <- cbind(xs,ys,eng2)
pp <- setNames(data.frame(pp), c("theta", "phi", "energy"))
plot_ly(pp, x = ~theta, y = ~phi, mode = "markers",type = "scatter", 
        color = ~energy, marker = list(size = 10)) %>%
  layout(title = "C2 true values")

pp <- cbind(xs,ys,eng1_est)
pp <- setNames(data.frame(pp), c("theta", "phi", "energy"))
plot_ly(pp, x = ~theta, y = ~phi, mode = "markers",type = "scatter", 
        color = ~energy, marker = list(size = 10)) %>%
  layout(title = "C1 fitted values")

pp <- cbind(xs,ys,eng2_est)
pp <- setNames(data.frame(pp), c("theta", "phi", "energy"))
plot_ly(pp, x = ~theta, y = ~phi, mode = "markers",type = "scatter", 
        color = ~energy, marker = list(size = 10)) %>%
  layout(title = "C2 fitted values")



pp <- cbind(xs,ys,zs,eng2_est - eng2)
pp <- setNames(data.frame(pp), c("x", "y", "z", "energy"))
plot_ly(pp,x=~x,y=~y,z=~z, type = "scatter3d",mode = "markers",color =~energy) %>%
  layout(
    title = "C2 Scaled Values",
    scene = list(
      xaxis = list(title = "x"),
      yaxis = list(title = "y"),
      zaxis = list(title = "z")
    ))

